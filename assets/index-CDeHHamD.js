!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let e=[];const t=document.getElementById("topText"),n=document.getElementById("bottomText"),a=document.getElementById("imageUpload"),o=document.getElementById("uploadBtn"),r=document.getElementById("showGalleryBtn"),i=document.getElementById("memeImage"),c=document.getElementById("suggestionsDropdown"),l=document.getElementById("suggestionsList"),s=document.getElementById("closeDropdown"),d=document.getElementById("downloadBtn"),m=document.getElementById("galleryModal"),u=document.getElementById("galleryGrid"),g=document.getElementById("closeGallery"),f=document.getElementById("infoBtn"),p=document.getElementById("infoModal"),h=document.getElementById("closeInfoModal"),v=document.getElementById("saveModal"),y=document.getElementById("saveImagePreview"),L=document.getElementById("closeSaveModal"),E=document.getElementById("openImageBtn"),x=document.getElementById("frameColorToggle");let w=null,b=[],k=null,I="#f8d248";const C="#f8d248",T="#5a2483";function B(e){w=e,c.classList.add("active")}function M(){c.classList.remove("active"),w=null}async function R(e){return new Promise(t=>{const n=new Image;n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e,setTimeout(()=>t(!1),2e3)})}async function S(){b=[];try{const e=await fetch("/meme-pics/images.json");if(!e.ok)throw new Error("File images.json non trovato");const t=await e.json();if(t.images&&Array.isArray(t.images))for(const n of t.images){await R(n)&&b.push(n)}return b.length>0}catch(e){return!1}}function U(){m.classList.remove("active")}function P(){p.classList.remove("active")}function j(){v.classList.remove("active"),y.src&&(URL.revokeObjectURL(y.src),y.src=""),k=null}function q(e){const t=e.textContent.trim(),n=e.querySelector(".placeholder");if(""===t||t===e.dataset.placeholder){if(e.classList.add("empty"),!n){const t=document.createElement("span");t.className="placeholder",t.textContent=e.dataset.placeholder,e.textContent="",e.appendChild(t)}}else e.classList.remove("empty"),n&&n.remove()}function O(){const e=t.textContent.trim(),a=t.querySelector(".placeholder"),o=""!==e&&!a&&e!==t.dataset.placeholder&&!t.classList.contains("empty"),r=n.textContent.trim(),c=n.querySelector(".placeholder"),l=""!==r&&!c&&r!==n.dataset.placeholder&&!n.classList.contains("empty"),s=i.src&&!i.src.includes("placeholder")&&""!==i.src&&"https://via.placeholder.com/400x300?text=Seleziona+Immagine"!==i.src;d.disabled=!o&&!l||!s}function A(){x&&(x.textContent=I===C?"ðŸŸ¡":"ðŸŸ£")}function H(e,t,n){const a=t.split(" "),o=[];let r=a[0];for(let i=1;i<a.length;i++){const t=a[i];e.measureText(r+" "+t).width<n?r+=" "+t:(o.push(r),r=t)}return o.push(r),o}t.addEventListener("click",e=>{const n=t.textContent.trim(),a=t.querySelector(".placeholder");(""===n||a||n===t.dataset.placeholder)&&B(t)}),n.addEventListener("click",e=>{const t=n.textContent.trim(),a=n.querySelector(".placeholder");(""===t||a||t===n.dataset.placeholder)&&B(n)}),t.addEventListener("focus",()=>{t.classList.remove("empty");const e=t.querySelector(".placeholder");e&&e.remove();const n=t.textContent.trim();""!==n&&n!==t.dataset.placeholder||B(t)}),n.addEventListener("focus",()=>{n.classList.remove("empty");const e=n.querySelector(".placeholder");e&&e.remove();const t=n.textContent.trim();""!==t&&t!==n.dataset.placeholder||B(n)}),document.addEventListener("click",e=>{c.contains(e.target)||e.target===t||e.target===n||t.contains(e.target)||n.contains(e.target)||M()}),s.addEventListener("click",M),r.addEventListener("click",async function(){m.classList.add("active"),u.innerHTML='<div style="padding: 40px; text-align: center; color: #667eea;"><div style="font-size: 18px; margin-bottom: 10px;">Caricamento immagini...</div><div style="font-size: 14px; color: #999;">Ricerca nella cartella meme-pics</div></div>',await S(),function(){if(u.innerHTML="",0===b.length)return void(u.innerHTML='<div style="padding: 20px; text-align: center; color: #999;">Nessuna immagine trovata nella cartella meme-pics.<br>Assicurati che le immagini abbiano nomi come: meme-1.jpg, meme-2.jpg, etc.</div>');b.forEach((e,t)=>{const n=document.createElement("div");n.className="gallery-item loading",n.innerHTML="<div>Caricamento...</div>",u.appendChild(n);const a=new Image;a.onload=()=>{n.className="gallery-item",n.innerHTML="";const a=document.createElement("img");a.src=e,a.alt=`Meme ${t+1}`,n.appendChild(a),n.addEventListener("click",()=>{i.src=e,U(),O()})},a.onerror=()=>{n.className="gallery-item error",n.innerHTML="Errore<br>caricamento"},a.src=e})}()}),g.addEventListener("click",U),m.addEventListener("click",e=>{e.target===m&&U()}),f.addEventListener("click",function(){p.classList.add("active")}),h.addEventListener("click",P),p.addEventListener("click",e=>{e.target===p&&P()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&p.classList.contains("active")&&P(),"Escape"===e.key&&v.classList.contains("active")&&j()}),L.addEventListener("click",j),v.addEventListener("click",e=>{e.target===v&&j()}),E.addEventListener("click",()=>{if(k){const e=URL.createObjectURL(k);window.open(e,"_blank")&&setTimeout(()=>{j()},500)}}),o.addEventListener("click",()=>{a.click()}),a.addEventListener("change",e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{i.src=e.target.result,O()},e.readAsDataURL(t)}}),t.addEventListener("blur",()=>{q(t),O()}),n.addEventListener("blur",()=>{q(n),O()}),t.addEventListener("input",()=>{q(t),O()}),n.addEventListener("input",()=>{q(n),O()}),d.addEventListener("click",async()=>{if(i.src&&!i.src.includes("placeholder")&&""!==i.src){d.disabled=!0,d.textContent="Generazione in corso...";try{await document.fonts.ready,document.fonts.check('bold 16px "Unbounded"')||await new Promise(e=>setTimeout(e,500));const e=document.createElement("canvas"),a=e.getContext("2d"),o=new Image;o.onerror=()=>{alert("Errore nel caricamento dell'immagine. Assicurati che l'immagine sia stata caricata correttamente."),d.disabled=!1,d.textContent="Scarica Meme"},o.onload=()=>{try{const r=85/150,i=510,c=i,l=Math.round(i/r),s=c,m=l/3,u=0,g=2*m,f=Math.max(28,s/14);a.font=`bold ${f}px 'Unbounded', sans-serif`,a.textAlign="center",a.textBaseline="top";let p=t.textContent.trim();t.querySelector(".placeholder")&&(p=""),p===t.dataset.placeholder&&(p="");let h=n.textContent.trim();n.querySelector(".placeholder")&&(h=""),h===n.dataset.placeholder&&(h="");const L=770;const E=o.width/o.height;let x=L,w=L*E;w>c&&(w=c,x=c/E);const b=(c-w)/2,C=(l-x)/2;e.width=c,e.height=l,a.fillStyle="white",a.fillRect(0,0,c,l);const T=()=>{a.drawImage(o,b,C,w,x)},B=()=>{function e(e,t,n,o,r){a.beginPath(),a.moveTo(e+r,t),a.lineTo(e+n-r,t),a.quadraticCurveTo(e+n,t,e+n,t+r),a.lineTo(e+n,t+o-r),a.quadraticCurveTo(e+n,t+o,e+n-r,t+o),a.lineTo(e+r,t+o),a.quadraticCurveTo(e,t+o,e,t+o-r),a.lineTo(e,t+r),a.quadraticCurveTo(e,t,e+r,t),a.closePath()}if(a.textAlign="center",a.textBaseline="top",a.font=`bold ${f}px 'Unbounded', sans-serif`,p){const t=H(a,p,s-40),n=t.length*f*1.4,o=u+m/2-n/2;let r=0;t.forEach(e=>{const t=a.measureText(e).width;t>r&&(r=t)});const i=20,c=r+2*i,l=n+2*i,d=(s-c)/2,g=o-i,h=15,v=16*(Math.random()-.5)*(Math.PI/180),y=d+c/2,L=g+l/2;a.save(),a.translate(y,L),a.rotate(v),a.translate(-y,-L),a.fillStyle="white",e(d,g,c,l,h),a.fill(),a.strokeStyle="black",a.lineWidth=5,e(d,g,c,l,h),a.stroke(),a.fillStyle="black",t.forEach((e,t)=>{const n=o+t*f*1.4;a.fillText(e,s/2,n)}),a.restore()}if(h){const t=H(a,h,s-40),n=t.length*f*1.4,o=g+m/2-n/2;let r=0;t.forEach(e=>{const t=a.measureText(e).width;t>r&&(r=t)});const i=20,c=r+2*i,l=n+2*i,d=(s-c)/2,u=o-i,p=15,v=16*(Math.random()-.5)*(Math.PI/180),y=d+c/2,L=u+l/2;a.save(),a.translate(y,L),a.rotate(v),a.translate(-y,-L),a.fillStyle="white",e(d,u,c,l,p),a.fill(),a.strokeStyle="black",a.lineWidth=5,e(d,u,c,l,p),a.stroke(),a.fillStyle="black",t.forEach((e,t)=>{const n=o+t*f*1.4;a.fillText(e,s/2,n)}),a.restore()}},M=()=>{e.toBlob(async e=>{if(!e)return alert("Errore durante il download del meme. Riprova."),d.disabled=!1,void(d.textContent="Scarica Meme");if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){k=e;const t=URL.createObjectURL(e);return y.src=t,v.classList.add("active"),d.disabled=!1,void(d.textContent="Scarica Meme")}const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="meme.png",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(t),d.disabled=!1,d.textContent="Scarica Meme"},100)},"image/png",1)};fetch("/border.svg").then(e=>e.text()).then(e=>{const t=e.replace(/#5a2483/g,I),n=new Blob([t],{type:"image/svg+xml"}),o=URL.createObjectURL(n),r=new Image;r.onload=()=>{T(),a.drawImage(r,0,0,c,l),B(),URL.revokeObjectURL(o),M()},r.onerror=()=>{URL.revokeObjectURL(o),T(),a.fillStyle=I,a.fillRect(0,0,c,8),a.fillRect(0,0,8,l),a.fillRect(c-8,0,8,l),a.fillRect(0,l-8,c,8),B(),M()},r.src=o}).catch(e=>{T(),a.fillStyle=I,a.fillRect(0,0,c,8),a.fillRect(0,0,8,l),a.fillRect(c-8,0,8,l),a.fillRect(0,l-8,c,8),B(),M()})}catch(r){alert("Errore durante la creazione del meme: "+r.message),d.disabled=!1,d.textContent="Scarica Meme"}},i.src.startsWith("data:")||(o.crossOrigin="anonymous"),o.src=i.src}catch(e){alert("Errore: "+e.message),d.disabled=!1,d.textContent="Scarica Meme"}}else alert("Per favore, seleziona o carica un'immagine prima di scaricare il meme.")}),x.addEventListener("click",()=>{I=I===C?T:C,A()}),async function(){await async function(){try{const t=await fetch("/frasi.md");if(!t.ok)throw new Error("File non trovato");const n=(await t.text()).split("\n").map(e=>e.trim()).filter(e=>e.startsWith("- ")).map(e=>e.substring(2).trim()).filter(e=>e.length>0);return n.length>0&&(e=n,!0)}catch(t){return!1}}(),await async function(){const e=document.getElementById("infoModalBody"),t="Il generatore di meme digitali sulla Teen Dating Violence, Ã¨ parte del progetto TDV meme workshop di Camilla Pisano";try{const n=await fetch("/info.md");if(!n.ok)throw new Error("File non trovato");const a=(await n.text()).split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(a.length>0){const t=a.join(" ").trim();if(t)return e.innerHTML=`<p>${t}</p>`,!0}return e.innerHTML=`<p>${t}</p>`,!1}catch(n){return e.innerHTML=`<p>${t}</p>`,!1}}(),await S(),l.innerHTML="",e.forEach(e=>{const t=document.createElement("div");t.className="suggestion-item",t.textContent=e,t.addEventListener("click",()=>{w&&(w.textContent=e,w.classList.remove("empty"),M(),O())}),l.appendChild(t)}),q(t),q(n),d.disabled=!0,O(),A()}();
